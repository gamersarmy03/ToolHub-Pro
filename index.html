<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Cross Speed</title>
  <style>
    html, body {
      margin: 0;
      overflow: hidden;
      height: 100%;
      background: #000;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }
    canvas {
      display: block;
    }
    #controls {
      position: fixed;
      bottom: 20px;
      width: 100%;
      display: flex;
      justify-content: space-between;
      padding: 0 20px;
      pointer-events: none;
    }
    .button {
      pointer-events: all;
      width: 80px;
      height: 80px;
      border: 2px solid #fff;
      border-radius: 50%;
      background: transparent;
      color: #fff;
      font-size: 14px;
      font-weight: bold;
      text-align: center;
      line-height: 80px;
      transition: transform 0.1s, background 0.2s;
    }
    .button:active {
      transform: scale(0.9);
      background: rgba(255, 255, 255, 0.2);
    }
  </style>
</head>
<body>
  <div id="controls">
    <button id="brake" class="button">Brake</button>
    <button id="accelerate" class="button">Accelerate</button>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/three@0.150.1/build/three.min.js"></script>
  <script>
    // Basic Setup
    const scene = new THREE.Scene();
    scene.fog = new THREE.Fog(0x87ceeb, 20, 200);

    const camera = new THREE.PerspectiveCamera(70, window.innerWidth/window.innerHeight, 0.1, 1000);
    camera.position.set(0, 3, -5);

    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    // Ground / Road
    const roadTexture = new THREE.TextureLoader().load('https://threejsfundamentals.org/threejs/resources/images/checker.png');
    roadTexture.wrapS = roadTexture.wrapT = THREE.RepeatWrapping;
    roadTexture.repeat.set(2, 100);

    const roadMaterial = new THREE.MeshStandardMaterial({ map: roadTexture });
    const road = new THREE.Mesh(new THREE.PlaneGeometry(8, 1000), roadMaterial);
    road.rotation.x = -Math.PI / 2;
    scene.add(road);

    // Car
    const car = new THREE.Mesh(
      new THREE.BoxGeometry(1, 0.5, 2),
      new THREE.MeshStandardMaterial({ color: 0xff0000 })
    );
    car.position.y = 0.25;
    scene.add(car);

    // Lights
    const ambientLight = new THREE.AmbientLight(0xffffff, 1);
    scene.add(ambientLight);

    const dirLight = new THREE.DirectionalLight(0xffffff, 0.5);
    dirLight.position.set(5, 10, 5);
    scene.add(dirLight);

    // Trees Left & Right
    const trees = [];
    const treeGeometry = new THREE.CylinderGeometry(0, 0.2, 1, 4);
    const treeMaterial = new THREE.MeshStandardMaterial({ color: 0x228B22 });

    for (let z = -50; z < 200; z += 10) {
      const leftTree = new THREE.Mesh(treeGeometry, treeMaterial);
      leftTree.position.set(-5, 0.5, -z);
      scene.add(leftTree);
      trees.push(leftTree);

      const rightTree = leftTree.clone();
      rightTree.position.x = 5;
      scene.add(rightTree);
      trees.push(rightTree);
    }

    // Controls
    let speed = 0.2;
    const brakeBtn = document.getElementById('brake');
    const accelBtn = document.getElementById('accelerate');

    let braking = false;
    let accelerating = false;

    brakeBtn.addEventListener('touchstart', () => braking = true);
    brakeBtn.addEventListener('touchend', () => braking = false);
    accelBtn.addEventListener('touchstart', () => accelerating = true);
    accelBtn.addEventListener('touchend', () => accelerating = false);

    let tilt = 0;
    window.addEventListener('deviceorientation', (event) => {
      tilt = event.gamma / 30;
    });

    // Animate
    let roadOffset = 0;

    function animate() {
      requestAnimationFrame(animate);

      // Update Speed
      if (braking) speed = Math.max(speed - 0.005, 0);
      if (accelerating) speed = Math.min(speed + 0.005, 0.5);

      // Move Road Texture
      roadOffset += speed * 2;
      roadTexture.offset.y = roadOffset * 0.05;

      // Update Car X
      car.position.x += (tilt * 4 - car.position.x) * 0.1;

      // Trees Recycling
      trees.forEach(tree => {
        tree.position.z += speed * 5;
        if (tree.position.z > camera.position.z + 10) {
          tree.position.z -= 250;
        }
      });

      // Update Camera
      camera.position.x = car.position.x * 0.5;
      camera.position.y = 3;
      camera.position.z = car.position.z - 5;
      camera.lookAt(car.position.x, 0.5, car.position.z + 5);

      renderer.render(scene, camera);
    }
    animate();

    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth/window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
  </script>
</body>
</html>
